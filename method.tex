\section*{Численный метод}

Для аппроксимации как двумерной задачи, так и линеаризованных уравнений применен один метод\cite{method}, по этому здась представлен способ аппроксимировать трехмерную систему уравнений, как более общий случай.

\subsection*{Аппроксимация трехмерной системы уравнений}

Численный метод, использованный в работе, описан в \cite{method}. Это конечно-разностный метод, позволяющий найти решение со вторым порядком точности по пространству и с третьим порядком точности по времени. В расчетной области вводится разнесенная, неравномерная сетка. Метод применим только в том случае, если в области можно ввести ортогональную систему координат в которой область представляет из себя паралеллепипед со стенками, параллельными координатным осям. То есть, если $\Omega$~--- расчетная область, то существуют такие отрезки $l_1, l_2, l_3$, что $\Omega = l_1 \times l_2 \times l_3$. 

\begin{figure}[htp]
  \begin{center}
    \begin{picture}(180,180)(-90,-90)
      \thinlines
     \put(-90,10){\vector(0,1){40}}
     \put(-90,10){\vector(1,0){40}}
     \put(-90,10){\vector(-1,-1){20}}
     \put(-97,46){\text{z}}
     \put(-56,3){\text{y}}
     \put(-110,-2){\text{x}}
      \thicklines
     \put(-30,-30){\line(0,1){60}}
     \put(-30,30){\line(1,0){60}}
     \put(30,30){\line(0,-1){60}}
     \put(30,-30){\line(-1,0){60}}
     %
     \put(-30,30){\line(1,1){24}}
     \put(30,30){\line(1,1){24}}
     \put(30,-30){\line(1,1){24}}
     %
     \put(-6,54){\line(1,0){60}}
     \put(54,54){\line(0,-1){60}}
      \thinlines
%     \put(-30,-30){\line(1,1){24}}
%    \put(-6,-6){\line(1,0){60}}
%     \put(-6,-6){\line(0,1){60}}
      \thicklines
     \put(0,0){\circle{6}}
     \put(3,-7){\text{$v_x$}}
     \put(42,12){\circle{6}}
     \put(44,5){\text{$v_y$}}
     \put(12,42){\circle{6}}
     \put(15,35){\text{$v_z$}}
     \put(-30,0){\circle*{4}}
     \put(-27,-7){\text{$\omega_z$}}
     \put(0,30){\circle*{4}}
     \put(3,23){\text{$\omega_y$}}
     \put(0,-30){\circle*{4}}
     \put(3,-37){\text{$\omega_y$}}
     \put(30,0){\circle*{4}}
     \put(33,-7){\text{$\omega_z$}}
     \put(54,24){\circle*{4}}
     \put(57,17){\text{$\omega_z$}}
     \put(42,-18){\circle*{4}}
     \put(45,-25){\text{$\omega_x$}}
     \put(42,42){\circle*{4}}
     \put(43,35){\text{$\omega_x$}}
     \put(24,54){\circle*{4}}
     \put(27,47){\text{$\omega_y$}}
     \put(-18,42){\circle*{4}}
     \put(-15,35){\text{$\omega_x$}}
    \end{picture}
  \end{center}
  \caption{Расположение узлов, к которым относятся компоненты векторов скорости и завихренности, на смещенных сетках. Изображена одная ячейка сетки. Давление p определяется в центре ячейки.}
  \label{picStag}
\end{figure}


Для того, что бы ввести неравномерную сетку, используется непрерывная монотонная функция преобразования $ x = x(\xi) $  , отображающая отрезок [0,1] в отрезок [0,1]. 
\begin{gather}
  x(\xi): [0,1] \longrightarrow [0,1]
\end{gather}
Такая функция переведет одномерную равномерную стетку, введеную на отрезке [0,1] в неравномерную. Введем равномерную сетку из $N_x$ ячеек 
\begin{gather}
 \Xi = \{\xi_i = ih, i = \overline{0..N_x}\}, \qquad h = 1 / N_x 
\end{gather}
Под разностной схемой, построенной на разнесенных сетках\footnote{так же разнесенные сетк называют перемежающиеся сетки, или смещенные сетки, Angl.: staggered mash.}, понимают такую, в которой разные неизвестные величины определины в разных узлах. В нашем случае одни неизвестные относятся к узлам сетки, то есть определены на множестве $\Xi$, а другие оносятся к центрам ячеек, и определены, соответственно, на множестве $\Xi_f$
\begin{gather}
 \Xi_f = \{ \xi_i = i*h - h/2, i = \overline{1..N_x} \}, \qquad h = 1/N_x
\end{gather}
Неравномерные сетки $X$ и $X_f$ есть отображение сеток $x(\xi)$ на $\Xi$ под действием преобразования $x(\xi)$
\begin{gather}
 X = x(\Xi) = \{x_i = x(\xi_i), \xi_i \in \Xi\} \\
 X_f = x(\Xi_f) = \{ x_i = x(\xi_i), \xi_i \in \Xi_f \}
\end{gather}

Если переменная определина в центрах ячеек, ее индекс соотвтствует номеру ячейки и меняется от 1 до $N_x$, а если переменная определена в узлах сетки, ее индекс соответствует номеру узла и меняется от 0 до $N_x$.

Далее используется обозначение $f_i = f(x_i) = f(x(\xi_i))$~--- значение неизвестного f в i-ой точке сетки. Если сказанно, что переменная относится к центру ячейки, значит она определена на сетке $\Xi_f$.  

Для произвольной функции f(x) справедливо утверждение:
$$
  \frac{\partial f}{\partial x} = \frac{\partial f}{\partial \xi} \frac{\partial \xi}{\partial x}
$$
Значение производной функии $x(\xi)$ может быть вычисленно точно,так как явный вид вункции известен.
В соответствии с данным утверждением построен разностный оператор дифференцирования $\delta_x$, аппроксимирующий производную со вторым порядко точности
\begin{gather}
 \delta_x f_i = \frac{\partial x(\xi_i)}{\partial \xi} \frac{f(x(\xi_i + h/2)) - f(x(\xi_i - h/2))}{h}  = \frac{\partial f(x_i)}{\partial x} + O(h^2)
\end{gather}

В частном случае, если предположить, что переменная $f$ определена в узлах сетки $ f_i \in F = f(X)$, тогда $\delta_x f$ относится к центрам ячеек и определяется выражением
$$
  (\delta_x f)_i = (f_i - f_{i-1}) \Delta_i, \text{ где } \Delta_i =  \frac{1}{h}\frac{\partial x(h*i - h/2)}{\partial \xi}
$$

Если, наоборот, $f$ определена в центрах ячеек $ f_i \in F = f(X_f)$, тогда $\delta_x f$
относится к узлам сетки и определяется выражением
$$
  (\delta_x f)_i = (f_{i+1} - f_i) \Delta_i, \text{ где } \Delta_i  = \frac{1}{h}\frac{\partial x(h*i)}{\partial \xi}
$$

Также, вводится вырадение для осреднения по пространству произвольной функции f(x) со вторым порядком точности. Оператор осреднения обозначается горизонтальной чертой над функцией. 
$$
  \overline{f}^x_i = \frac{f(x(\xi_i - h/2)) + f(x(\xi_i + h/2))}{2} = f_i + O(h^2)
$$

В нашем случае, если $f$ определена в узлах сетки $f_i \in F = f(X)$, тогда $\overline{f}^x_i$ относится к центрам ячеек и определеляется выражением
$$
  \overline{f}^x_i = \frac{f_{i-1} + f_{i}}{2}
$$

Если $f$ определена в центрах ячеек $f_i \in F = f(X_f)$, тогда $\overline{f}^x_i$ относится к узлам сетки и определяется выражением
$$
  \overline{f}^x_i = \frac{f_i + f_{i+1}}{2}
$$


Далее описанно ведение сетки в трехмерной области. 
По аналогии с парой $\{X,X_f\}$, введены пары сеток $\{Y,Y_f\}$ и $\{Z,Z_f\}$. В нашем случае необходимо вычислить три компоненты вектора скорости, три компоненты вектора завихренности и двление. Давление относится к центрам ячеек, что значит, что оно определено на множестве точек $X_f \times Y_f \times Z_f$.
$$
  P = \{p_{ijk} = p(x_i,y_j,z_k), \text{ при } x_i \in X_f, y_i \in Y_f, z_i \in Z_f\}
$$
Компоненты вектора скорости относятся к центрам граней ячеек, вектор нормали которых сонаправлен с определяемым вектором.
\begin{gather*}
  V_x = \{ v^x_{ijk} = v_x(x_i,y_j,z_k), \text{ при } x_i \in X, y_i \in Y_f, z_i \in Z_f \} \\
  V_y = \{ v^y_{ijk} = v_y(x_i,y_j,z_k), \text{ при } x_i \in X_f, y_i \in Y, z_i \in Z_f \} \\
  V_z = \{ v^z_{ijk} = v_z(x_i,y_j,z_k), \text{ при } x_i \in X, y_i \in Y_f, z_i \in Z \}
\end{gather*}
Компоненты вектора завихренности определяются в центрах ребер ячейки, соноправленных с определяемым вектором. 
\begin{gather*}
  \Omega_x = \{ \omega^x_{ijk} = \omega_x(x_i,y_j,z_k), \text{ при } x_i \in X_f, y_i \in Y, z_i \in Z \} \\
  \Omega_y = \{ \omega^y_{ijk} = \omega_y(x_i,y_j,z_k), \text{ при } x_i \in X, y_i \in Y_f, z_i \in Z \} \\
  \Omega_z = \{ \omega^z_{ijk} = \omega_z(x_i,y_j,z_k), \text{ при } x_i \in X, y_i \in Y, z_i \in Z_f \}
\end{gather*}
Иллюстрация на Рис \ref{picStag}.

Этого достаточно для того, что бы записать разностную аппроксимацию исходной системы уравнений. Для прямойгольной системы координат, как в нашем случае, разностная аппроксимация системы несколько проще, чем для произвольной ортогональной системы координат, и записывается так:
\begin{gather}
  \delta_x v_x + \delta_y v_y + \delta_z v_z = 0 
  \\
  \omega_x = \delta_y v_z - \delta_z v_y 
  \\
  \omega_y = \delta_z v_x - \delta_x v_z 
  \\
  \omega_z = \delta_x v_y - \delta_y v_x 
  \\
  \frac{\partial v_x}{\partial t} = \frac{1}{y'}\overline{\overline{y'v_y}^x \omega_z}^y - \frac{1}{z'}\overline{\overline{z'v_z}^x \omega_y}^z - \delta_x p - \nu (\delta_y \omega_z - \delta_z \omega_y)
  \\
  \frac{\partial v_y}{\partial t} = \frac{1}{z'}\overline{\overline{z'v_z}^y \omega_x}^z - \frac{1}{x'}\overline{\overline{x'v_x}^y \omega_z}^x - \delta_y p - \nu (\delta_z \omega_x - \delta_x \omega_z) 
  \\
  \frac{\partial v_z}{\partial t} = \frac{1}{x'}\overline{\overline{x'v_x}^z \omega_y}^x - \frac{1}{y'}\overline{\overline{y'v_y}^z \omega_x}^y - \delta_z p - \nu (\delta_x \omega_y - \delta_y \omega_x)
\end{gather}
Зная значение скоростей в каждой точке, на каждом шаге, используя приведенные формулы, можно расчитать производную скорости по времени. Как сделать шаг по времени описанно в следующей секции. 

\subsection*{Интегрирование по времени}

Решаемая задача~--- задача Каши, для интегрирования по времени применим метод Рунге-Кутта третьего порядка точности.
Если интегрируемую систему представить в виде 
$$
	\dot w = H(t,w),
$$
обозначить за D~--- оператор дивиргенции, G~--- оператор градиента, L - некоторый линейный оператор, то метод представим в следующем виде:

\begin{gather}
\begin{align*}
Step 1:& \\
&&H_n &= H(t_n, w_n) \\
&&DGp_n &= DH_n \\
&&(I - \gamma \tau L)(w' - w_n) &= \frac{2}{3} \tau (H_n - Gp_n) \\
%
Step 2:& \\
&&H' &= H(t_n + 2\tau/3, w') \\
&&DGp' &= DH' \\
&&(I - \gamma \tau L)(w'' - \frac{2}{3}w' + \frac{1}{2}w_n) &= \frac{1}{2} \tau (H' - Gp') + w_n - w' \\
&&(I - \gamma \tau L)(\tilde w_{n+1} - \frac{3}{2}w'' + \frac{3}{4}w' - \frac{1}{4}w_n) &= \frac{3}{4}(w'' - w_n)\\
%
Step 3:& \\
&&H'' &= H(t_n + 2\tau/3, w'') \\
&&(I - \gamma \tau L)(\hat w_{n+1} - \frac{1}{2} \tilde w_{n+1} - \frac{3}{4}w'' + \frac{1}{4}w_n) &= \frac{3}{4} \tau (H'' - Gp') + 
	\frac{5}{8}w_n + \frac{3}{8}w'' - \tilde w_{n+1} \\
&&DGq &= D\tilde w_{n+1} \\
&&w_{n+1} &= \hat w_{n+1} - Gq
\end{align*}
\end{gather}

Если выбрать L = 0, получим явный метод. Но, несмотря на то, что задача нелинейная, выбором оператора L можно увеличить область устойчивости метода. Такой метод называет \textit{полу-неявный}\footnote{Англ: semi-implicit}. 

Оптимальное значение параметра $\gamma$ выбирается эмпирическим путем, при расчетах был выбран $\gamma=0.5$. 

Замечено, что причина неустоичивость численного метожа лежит в слагаемом, отвечающем за вязкость$$
	\nu (\nabla \times \vec \omega) = \nu \nabla ^2 \vec v
$$ Это линейный оператор, поэтому можно выбрать $L = \nu \nabla^2$. Здесь $\nu = \frac{1}{Re}$~--- кинематическая вязкость. 

На практике удобнее модифецировать оператор L так, что бы выполнялось соотношение
\begin{gather*}
	(I - \gamma \tau L) = (I - \gamma \tau \nu \delta_x^2)(I - \gamma \tau \nu \delta_y^2) \\
	L =  \nu (\delta_x^2 + \delta_y^2) - \gamma \tau \nu \delta_x^2 \delta_y^2 = \nu \nabla^2 + o(\tau)
\end{gather*}
С одной стороны, оператор L приближает вязкий член уравнения с первым порядком малости по шагу по времени, с другой стороны, неявное уравнение можно решить применив прогонку по каждомц из направлений. Время, затраченое на прогонку, не сравнимо мало по сравнению с временем, требуемым на решение элептического уравнения для давления. 

Выбрав таким образом оператор L, можно при Re=1000, например, увеличить область устойчивости на 2 порядка, то есть уменьшить время счета на 2 порядка, что весьма сещественно. 


\newpage

